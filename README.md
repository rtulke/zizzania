# AirSnare (formerly zizzania)

AirSnare sniffs wireless traffic listening for WPA handshakes and dumping only those frames suitable to be decrypted (one beacon + EAPOL frames + data). In order to speed up the process, AirSnare sends IEEE 802.11 DeAuth frames to the stations whose handshake is needed, properly handling retransmissions and reassociations and trying to limit the number of DeAuth frames sent to each station.

![Screenshot](https://i.imgur.com/zGxPSTE.png)

## Examples

Put the network interface in RFMON mode on channel 6 and save the traffic gathered from the stations associated to a specific access point excluding those whose MAC address starts with `00:11:22`:

```
airsnare -i wlan0 -c 6 -b AA:BB:CC:DD:EE:FF -x 00:11:22:33:44:55/ff:ff:ff:00:00:00 -w out.pcap
```

---

Passively analyze the traffic generated by any station on the current channel assuming that the network interface is already RFMON mode:

```
airsnare -i wlan0 -n
```

---

Strip unnecessary frames from a pcap file (excluding altogether the traffic generated by one particular station) considering an handshake complete after just the first two messages (which should be enough for unicast traffic decryption):

```
airsnare -r in.pcap -x 00:11:22:33:44:55 -w out.pcap
```

## Setup

### Dependencies

For Debian-based systems:

```
sudo apt-get install libpcap-dev
```

For macOS systems (Homebrew):

```
brew install libpcap wget
```

### Building

```
make -f config.Makefile
make
```

### Installation

The installation process is not mandatory, AirSnare can be run from the `src` directory. Just in case:

```
make install
make uninstall
```

### Configuration

AirSnare liest Konfigurationsdateien **vor** den CLI-Argumenten ein, wobei jede Quelle die vorherige überschreibt:

1. `/etc/airsnare.conf` (systemweit, optional)
2. `~/.airsnarerc` (benutzerspezifisch, optional)
3. Jede Datei, die über `--config <pfad>` angegeben wird (kann mehrfach verwendet werden)
4. Kommandozeilenargumente (höchste Priorität)

Das Format ist bewusst schlicht gehalten (`schlüssel = wert` pro Zeile, Kommentare via `#` oder `;`). Beispielwerte findest du in `airsnare.conf.example`. Pfade verstehen `~`, Strings können optional in `'` oder `"` gesetzt werden.

**Verfügbare Schlüssel**

| Schlüssel | Typ | Beschreibung / CLI-Entsprechung |
|-----------|-----|----------------------------------|
| `interface`, `input` | string | Live-Interface (entspricht `-i`) |
| `pcap`, `input_file` | string | Pcap-Datei statt Interface (`-r`) |
| `output`, `write_file` | string | Ausgabedatei (`-w`) |
| `channel` | int | Kanal (`-c`) |
| `no_rfmon` | bool | RFMON-Setup überspringen (`-M`) |
| `passive` | bool | Passives Sniffing (`-n`) |
| `deauth_count` | int | Frames pro Burst (`-d`) |
| `deauth_attempts` | int | Max. Versuche (`-a`) |
| `deauth_interval` | int | Sekunden zwischen Bursts (`-t`) |
| `dump_group_traffic` | bool | Broadcast/Mcast mitschreiben (`-g`) |
| `early_quit` | bool | Nach erstem Handshake beenden (`-q`) |
| `max_handshake` | int 2-4 | Anzahl Handshake-Messages (`-2`/`-3`/Default 4) |
| `bssid_include` / `bssid_exclude` | csv | Liste von MAC-/Maskenfiltern (`-b`/`-B`) |
| `station_include` / `station_exclude` | csv | Stationsfilter (`-s`/`-S`) |
| `bssid_exclude_first` / `station_exclude_first` | bool | Reihenfolge für Filter (`-x b` / `-x s`) |
| `log_level` | string/int | `error`, `info`, `warn`, `debug`, `trace` oder `0-4` (CLI: `-v` mehrfach) |

CSV-Felder nehmen Komma-getrennte Einträge wie `AA:BB:.../ff:ff:...`. Booleans akzeptieren `true/false`, `yes/no`, `on/off`, `0/1`. Ungültige Einträge werden mit Dateiname+Zeile gemeldet und stoppen das Einlesen der betroffenen Datei.

**Schnellstart**

```
cp airsnare.conf.example ~/.airsnarerc
vim ~/.airsnarerc   # oder Editor deiner Wahl
./src/airsnare --config ~/.airsnarerc -n
```

So lässt sich ein Projektprofil pflegen und trotzdem einzelne Flags (z.B. `-n`, `-v`) zur Laufzeit überschreiben.

## macOS support

Channel switching must be performed manually:

```
ln -s /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport /usr/local/bin/airport
sudo airport --disassociate
sudo airport --channel=<channel>
```

## Code Structure

```
src/
|-- airsnare.c              # Main entry point - program orchestration and lifecycle
|
|-- handler.c/h             # Handler lifecycle - pcap setup, BPF filtering, packet loop
|-- dissector.c/h           # Packet dissection - parses 802.11 frames, applies filters
|-- handshake.c/h           # WPA handshake state machine - tracks 4-way handshake progress
|-- killer.c/h              # Deauthentication subsystem - manages and injects deauth frames
|-- dispatcher.c/h          # Signal handling - periodic killer invocation and SIGUSR1/SIGALRM
|
|-- clients.c/h             # Client tracking - per-station handshake state and replay counters
|-- bsss.c/h                # Access point tracking - BSS descriptors with SSID and statistics
|-- members.c/h             # MAC address sets - whitelist/blacklist with subnet mask support
|
|-- ieee802.c/h             # IEEE 802.11 protocol - frame structures, EAPOL, MAC utilities
|-- options.c/h             # Command-line parsing - argument validation and configuration
|-- terminal.c/h            # Terminal output - ANSI colors, logging, statistics display
|-- util.c/h                # Privilege management - setuid/setgid for dropping root
|-- iface.c/h               # Interface configuration - platform-specific channel setting
|
|-- params.h                # Runtime parameters - timeout constants and grace periods
|-- release.h               # Version metadata - version number and author information
`-- endian.h                # Endianness macros - byte order conversion for Linux/macOS
```
